### Swagger Kurulumu
1. `Swashbuckle.AspNetCore` Paketini yükleyerek başlayalım.
2. `Startup.cs` dosyası aşağıdaki şekilde olacak:
```csharp
public class Startup
{
    //...

    public void ConfigureServices(IServiceCollection services)
    {
        services.AddMvc().SetCompatibilityVersion(CompatibilityVersion.Version_2_1);

        //This line adds Swagger generation services to our container.
        services.AddSwaggerGen(c =>
        {
            //The generated Swagger JSON file will have these properties.
            
            c.SwaggerDoc("v1", new OpenApiInfo
            {
                Version = "v1",
                Title = "Swagger XML Api Demo",
                Description = "A simple example ASP.NET Core Web API",
                TermsOfService = new Uri("https://example.com/terms"),
                Contact = new OpenApiContact
                {
                    Name = "Shayne Boyer",
                    Email = string.Empty,
                    Url = new Uri("https://twitter.com/spboyer"),
                },
                License = new OpenApiLicense
                {
                    Name = "Use under LICX",
                    Url = new Uri("https://example.com/license"),
                }
            });
            
            //Locate the XML file being generated by ASP.NET...
            var xmlFile = $"{Assembly.GetExecutingAssembly().GetName().Name}.XML";
            var xmlPath = Path.Combine(AppContext.BaseDirectory, xmlFile);
            
            //... and tell Swagger to use those XML comments.
            c.IncludeXmlComments(xmlPath);
        });
    }

    // This method gets called by the runtime. Use this method to configure the HTTP request pipeline.
    public void Configure(IApplicationBuilder app, IHostingEnvironment env)
    {
        if (env.IsDevelopment())
        {
            app.UseDeveloperExceptionPage();
        }

        app.UseMvc();

        //This line enables the app to use Swagger, with the configuration in the ConfigureServices method.
        app.UseSwagger();
        
        //This line enables Swagger UI, which provides us with a nice, simple UI with which we can view our API calls.
        app.UseSwaggerUI(c =>
        {
            c.SwaggerEndpoint("/swagger/v1/swagger.json", "Swagger XML Api Demo v1");
        });
    }
}
```

3. Projenin özelliklerinden XML dosyası oluşturmayı açmamız gerekiyor. XML yorumlar ekleyerek SWAGGER UI'ın daha yardımcı görüntüleme yapabilmesini istiyoruz çünkü.
![https://exceptionnotfound.net/content/images/2018/07/xml-doc-file-build.png](https://user-images.githubusercontent.com/261946/70221619-c00fa380-1759-11ea-9f77-a5295e136cb7.png)

4. Ancak XML oluşturma nedeniyle bazı uyarılar alacağız aşağıdaki gibi
![image](https://user-images.githubusercontent.com/261946/70222307-e97cff00-175a-11ea-9a87-ffdc50a0f8a0.png)

Bu uyarıları baskılamak için iki yolumuz var

4.1. Proje ayarlarından:
![Suppres warnings 1591 eklenir](https://user-images.githubusercontent.com/261946/70222369-0a455480-175b-11ea-8d44-6b2ba8775492.png)

4.2 Proje dosyasından:
![image](https://user-images.githubusercontent.com/261946/70222960-d28adc80-175b-11ea-86f8-17fe5825f8e3.png)

### Swagger XML Yorumlarını Nasıl Görüntülüyor?
Swagger'ın yorumlayabildiği [XML düğümleri](https://docs.microsoft.com/en-us/dotnet/csharp/codedoc) şunlar:
* *[summary](https://docs.microsoft.com/en-us/dotnet/csharp/codedoc#summary):* method/class/field gibi üyeler için özet bilgi yazabildiğimiz XML düğümü
* *[remarks](https://docs.microsoft.com/en-us/dotnet/csharp/codedoc#remarks):* method/class/field gibi üyeler için FAZLADAN bilgi girebileceğimiz düğüm
* *[param](https://docs.microsoft.com/en-us/dotnet/csharp/codedoc#param):* Metotların parametreleri hakkında bilgi yazabileceğimiz düğüm
* *[returns](https://docs.microsoft.com/en-us/dotnet/csharp/codedoc#returns):* Metodun dönüş verisiyle ilgili bilgi yazabileceğimiz düğüm
Maalesef returns düğümünü Swagger UI görüntülemiyor. Dönen değer tipine bakarak varsayılan olarak yazabiliyor veya `[ProducesResponseType]` özelliğine bakarak değerlendiriyor.
* *see:* Bir tipi referans verebilir onun tam adıyla görüntülenmesini sağlayabilirsiniz
![image](https://user-images.githubusercontent.com/261946/70236627-5a7de000-1776-11ea-8931-5de0fd154f81.png)

Bu ekran çıktısını genel olarak güzel bir gösterimi olduğu yapıştırıyorum. Ama daha detaylı halini aşağıda ekleyeceğim.
![image](https://user-images.githubusercontent.com/261946/70224760-df5cff80-175e-11ea-89b5-d1c45b111ba4.png)

Swagger;
- Veri girişlerinin formatı için **Consumes** niteliğini,
- Metotlardan dönecek verinin formatı için **Produces** niteliğini,
- Metotlardan dönebilecek yanıt kodları (response status codes) için **ProducesResponseType** niteliğini kullanır.


### Veri Girişlerinin Formatları (Consumes)
`WeatherForecast` Tipini metodun alabileceği formatlara göre görüntüler. Metodun alabileceği formatları `[Consumes]` özelliğinden okur. 
`[Consumes]` İle belirtilen formatları açılır kutuda listeleyerek istenilen formata göre `WeatherForecast` tipini serileştirir.
```csharp
[Consumes("application/json", "application/xml", "application/x-www-form-urlencoded")]
```

1. ###### `application/json` İçin:
![image](https://user-images.githubusercontent.com/261946/70239788-032f3e00-177d-11ea-82e2-2b24f060fe51.png)

2. ###### `application/xml` İçin:
![image](https://user-images.githubusercontent.com/261946/70239836-1c37ef00-177d-11ea-9411-a9d03b04cd84.png)

3. ###### `application/x-www-form-urlencoded` İçin:
![image](https://user-images.githubusercontent.com/261946/70239898-3eca0800-177d-11ea-9a0e-9d83a99b9947.png)



### PARAMETRELER
Bir metodun parametre listesinde mecburi (required) ve seçimli (optional) parametreler olabilir. 

#### Mecburi (required) Parametre

```csharp
public Response Post(int predefinedId, int? oylesine, [FromBody] WeatherForecast wcast) {
    return new Response() { };
}
```

Mecburi parametre olan `predefinedId` Swagger tarafından **required* olarak görüntüleniyor.
![image](https://user-images.githubusercontent.com/261946/70237216-bb59e800-1777-11ea-91b1-4e2b42ce14cb.png)
`http://localhost:63270/api/WeatherForecast/123` Adresindeki 123 değeri metoda `predefinedId` isimli parametre olarak geçecek.

#### Seçimli (optional) Parametre

Seçimli parametre olan `userId` URL satırında Query olarak girilebilecek. Zorunlu olmadığı için **required* görünmeyecek.
![image](https://user-images.githubusercontent.com/261946/70237545-84380680-1778-11ea-8ae6-d8ae870b8c31.png)

#### `[FromBody]` Özelliğiyle Gövdede Taşınan Veri
HTTP Paketinin gövdesinde (body) gelen verinin içeriğini yine metodun parametre listesinden okur: 
```csharp
[FromBody] WeatherForecast wcast
```


### Dönüş Tipleri (`<returns>`)
1. `<returns>` XML düğümüne girilen bilgileri **Swagger görüntülemiyor!** 
2. `[ProducesResponseType]` ve `/// <response code="401">Yetkisiz erişim.</response>` açıklamalarını görüntüler.
3. `[Produces("application/json", "application/xml")]` ilgili metodun tüm yanıt kodları için (response status codes) 
dönülecek cevabın formatlarını belirler

### Cevaplar (Responses)
> Her bir yanıt kodu için XML yorumunu `<response>` etiketi ve `[ProducesResponseType]` yapabilirsiniz.
> ![image](https://user-images.githubusercontent.com/261946/70308419-4391c900-181c-11ea-9456-42007122b768.png)


##### 500 - Internal Server Error
- 500 Sunucu hatası. 
- Dönecek veri doğrudan istisnanın `string` halidir.
- Swagger UI; 500 kodunda dönecek mesajı belgelendirsin diye `[ProducesResponseType(typeof(string), StatusCodes.Status500InternalServerError)]` yazdık.

![image](https://user-images.githubusercontent.com/261946/70238213-e6453b80-1779-11ea-9e45-8613f04f14f0.png)
- Eğer 500 kodu için xml yorumu yazmazsak varsayılan metin `Server Error` görüntülenecek

![image](https://user-images.githubusercontent.com/261946/70307745-e9443880-181a-11ea-828a-44a1d888361d.png)
- Eğer XML yorumunu eklersek:
```csharp
/// <response code="500">Sunucu hatası dönüş tipine bakmaz doğrudan string tipinde sonuç döner.</response>
```

![image](https://user-images.githubusercontent.com/261946/70307958-5788fb00-181b-11ea-87e6-996fd2c098a7.png)

- `[ProducesResponseType(typeof(string)...]` ile `string` döneceğini düşündüğümüz metot hata fırlatınca sonucu:

![image](https://user-images.githubusercontent.com/261946/70237964-57d0ba00-1779-11ea-9edd-e3b261a8e84e.png)

#### 500 - Internal Server Error